<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Atelier Clandestin - Shopify Import Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
        .header h1 { font-size: 36px; margin-bottom: 10px; }
        .header p { font-size: 18px; opacity: 0.95; }
        .tabs { display: flex; gap: 5px; margin-bottom: 25px; border-bottom: 3px solid #e0e0e0; background: white; border-radius: 10px 10px 0 0; padding: 10px 10px 0 10px; }
        .tab { padding: 15px 30px; background: none; border: none; font-size: 16px; cursor: pointer; color: #666; font-weight: 600; border-radius: 8px 8px 0 0; transition: all 0.3s; }
        .tab.active { color: #667eea; background: white; border-bottom: 3px solid #667eea; margin-bottom: -3px; }
        .tab:hover:not(.active) { background: #f5f5f5; }
        .section { background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        .section h2 { font-size: 24px; margin-bottom: 15px; color: #333; display: flex; align-items: center; gap: 10px; }
        .section h3 { font-size: 18px; margin: 20px 0 10px 0; color: #555; }
        .file-upload { border: 2px dashed #ddd; padding: 30px; border-radius: 8px; text-align: center; margin: 15px 0; background: #fafafa; transition: all 0.3s; }
        .file-upload:hover { border-color: #667eea; background: #f0f4ff; }
        .file-upload input { width: 100%; padding: 10px; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .btn-success { background: #48bb78; color: white; }
        .btn-success:hover { background: #38a169; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4); }
        .btn-danger { background: #f56565; color: white; }
        .btn-danger:hover { background: #e53e3e; }
        .btn-secondary { background: #718096; color: white; }
        .btn-secondary:hover { background: #4a5568; }
        .btn:disabled { background: #cbd5e0; cursor: not-allowed; transform: none; }
        .btn-row { display: flex; gap: 15px; margin: 25px 0; flex-wrap: wrap; }
        .supplier-card { background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #667eea; }
        .supplier-card h4 { font-size: 20px; margin-bottom: 10px; color: #2d3748; }
        .supplier-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; }
        .supplier-stat { background: white; padding: 12px; border-radius: 6px; }
        .supplier-stat strong { color: #4a5568; font-size: 12px; display: block; margin-bottom: 5px; }
        .supplier-stat span { color: #2d3748; font-size: 18px; font-weight: 600; }
        .status { padding: 15px 20px; border-radius: 8px; margin: 20px 0; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        .status.success { background: #c6f6d5; color: #22543d; border-left: 4px solid #38a169; }
        .status.error { background: #fed7d7; color: #742a2a; border-left: 4px solid #e53e3e; }
        .status.warning { background: #feebc8; color: #7c2d12; border-left: 4px solid #dd6b20; }
        .status.info { background: #bee3f8; color: #2c5282; border-left: 4px solid #3182ce; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #f7fafc; font-weight: 600; color: #2d3748; position: sticky; top: 0; }
        tbody tr:hover { background: #f7fafc; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; margin-top: 15px; max-height: 400px; overflow-y: auto; }
        .image-item { position: relative; aspect-ratio: 1; }
        .image-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; border: 2px solid #e2e8f0; }
        .image-item button { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; }
        .image-item .name { font-size: 11px; margin-top: 5px; color: #4a5568; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .form-group { margin: 20px 0; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #2d3748; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 14px; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .hidden { display: none; }
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-content h3 { margin-bottom: 20px; }
        .progress-bar { background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; margin: 15px 0; }
        .progress-fill { background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; transition: width 0.3s; }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-success { background: #c6f6d5; color: #22543d; }
        .badge-warning { background: #feebc8; color: #7c2d12; }
        .badge-error { background: #fed7d7; color: #742a2a; }
        .instructions { background: linear-gradient(135deg, #fef5e7 0%, #fef9e7 100%); border-left: 4px solid #f39c12; padding: 25px; margin-top: 30px; border-radius: 8px; }
        .instructions h3 { margin-bottom: 15px; color: #d68910; }
        .instructions li { margin: 10px 0; line-height: 1.6; }
        .instructions strong { color: #d68910; }
        .quick-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-card .number { font-size: 36px; font-weight: bold; }
        .stat-card .label { font-size: 14px; opacity: 0.9; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö¥ L'Atelier Clandestin</h1>
            <p>Shopify Import Tool - Invoice to Inventory in Minutes</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('process')">üì¶ Process New Stock</button>
            <button class="tab" onclick="showTab('suppliers')">üè≠ Suppliers (<span id="supplier-count">0</span>)</button>
            <button class="tab" onclick="showTab('migration')">üîÑ Lightspeed Migration</button>
            <button class="tab" onclick="showTab('settings')">‚öôÔ∏è Settings</button>
        </div>

        <!-- TAB 1: PROCESS NEW STOCK -->
        <div id="process-tab">
            <div class="section">
                <h2>üìÑ Upload Invoice or Packing List</h2>
                <p style="color: #666; margin-bottom: 20px;">Upload today's supplier invoice (PDF, Excel, or CSV) to automatically create Shopify products</p>
                
                <div class="form-group">
                    <label>Select Supplier</label>
                    <select id="supplier-select">
                        <option value="">-- Select Supplier --</option>
                    </select>
                </div>

                <div class="file-upload">
                    <input type="file" id="invoice-upload" accept=".pdf,.xlsx,.xls,.csv" onchange="handleInvoiceUpload(this)">
                    <p style="margin-top: 10px; color: #666;">Accepts PDF, Excel, or CSV files</p>
                </div>

                <div id="invoice-status"></div>
                <div id="processing-progress" class="hidden">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <p id="progress-text" style="text-align: center; color: #666;"></p>
                </div>

                <div class="btn-row">
                    <button class="btn btn-primary" id="process-btn" onclick="processInvoice()" disabled>‚öôÔ∏è Process Invoice</button>
                    <button class="btn btn-success" id="download-btn" onclick="downloadShopifyCSV()" disabled>üì• Download Shopify CSV</button>
                    <button class="btn btn-secondary" onclick="clearInvoice()">üîÑ Clear</button>
                </div>
            </div>

            <div id="preview-section" class="section hidden">
                <h2>üìä Preview - Ready to Import</h2>
                <div class="quick-stats" id="quick-stats"></div>
                <div id="preview-table"></div>
            </div>
        </div>

        <!-- TAB 2: SUPPLIERS -->
        <div id="suppliers-tab" class="hidden">
            <div class="section">
                <h2>üè≠ Supplier Management</h2>
                <p style="color: #666; margin-bottom: 20px;">Manage supplier catalogs, images, and pricing rules</p>
                <button class="btn btn-primary" onclick="showAddSupplierModal()">‚ûï Add New Supplier</button>
            </div>

            <div id="suppliers-list"></div>
        </div>

        <!-- TAB 3: LIGHTSPEED MIGRATION -->
        <div id="migration-tab" class="hidden">
            <div class="section">
                <h2>üîÑ Lightspeed to Shopify Migration</h2>
                <p style="color: #666; margin-bottom: 20px;">One-time migration tools for moving from Lightspeed</p>
                
                <div class="grid-2">
                    <div>
                        <h3>üì¶ Products Export</h3>
                        <input type="file" multiple accept=".xlsx,.xls,.csv" onchange="handleMigration('products', this)">
                        <div id="migration-products-list"></div>
                    </div>
                    <div>
                        <h3>üë• Customers Export</h3>
                        <input type="file" multiple accept=".xlsx,.xls,.csv" onchange="handleMigration('customers', this)">
                        <div id="migration-customers-list"></div>
                    </div>
                </div>

                <div class="btn-row">
                    <button class="btn btn-primary" onclick="processMigration('products')">‚öôÔ∏è Process Products</button>
                    <button class="btn btn-primary" onclick="processMigration('customers')" style="background: #9f7aea;">üë• Process Customers</button>
                    <button class="btn btn-success" id="download-migration-products" onclick="downloadMigrationCSV('products')" disabled>üì• Download Products CSV</button>
                    <button class="btn btn-success" id="download-migration-customers" onclick="downloadMigrationCSV('customers')" disabled>üì• Download Customers CSV</button>
                </div>
            </div>
        </div>

        <!-- TAB 4: SETTINGS -->
        <div id="settings-tab" class="hidden">
            <div class="section">
                <h2>‚öôÔ∏è Global Settings</h2>
                
                <div class="form-group">
                    <label>Default Markup Percentage</label>
                    <input type="number" id="default-markup" placeholder="2.3" step="0.1" value="2.3">
                    <small style="color: #666;">Used when supplier doesn't have specific markup rule</small>
                </div>

                <div class="form-group">
                    <label>Shop Name</label>
                    <input type="text" id="shop-name" value="L'Atelier Clandestin">
                </div>

                <h3>üíæ Data Management</h3>
                <div class="btn-row">
                    <button class="btn btn-primary" onclick="exportAllData()">üì§ Export All Data</button>
                    <button class="btn btn-success" onclick="document.getElementById('import-data-input').click()">üì• Import Data</button>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                </div>
                <input type="file" id="import-data-input" accept=".json" onchange="importAllData(this)" style="display:none">
            </div>
        </div>

        <div class="instructions">
            <h3>üìã How to Use This Tool</h3>
            <ol>
                <li><strong>First Time Setup:</strong> Add your suppliers in the "Suppliers" tab with their master catalogs and product images</li>
                <li><strong>Set Pricing Rules:</strong> Configure markup percentage or use supplier MSRP for each supplier</li>
                <li><strong>Daily Use:</strong> Upload invoice ‚Üí Select supplier ‚Üí Process ‚Üí Download CSV ‚Üí Import to Shopify</li>
                <li><strong>Migration:</strong> Use the "Lightspeed Migration" tab for one-time data transfer</li>
            </ol>
            
            <h4 style="margin-top: 20px;">üí° Pro Tips:</h4>
            <ul>
                <li>Name image files with SKU or UPC for automatic matching (e.g., "12798.jpg")</li>
                <li>Keep supplier master files updated for best results</li>
                <li>Review the preview before downloading to catch any issues</li>
                <li>Export your data regularly as backup</li>
            </ul>
        </div>
    </div>

    <!-- ADD SUPPLIER MODAL -->
    <div id="add-supplier-modal" class="modal hidden">
        <div class="modal-content">
            <h3>‚ûï Add New Supplier</h3>
            
            <div class="form-group">
                <label>Supplier Name</label>
                <input type="text" id="new-supplier-name" placeholder="Cycles Lambert">
            </div>

            <div class="form-group">
                <label>Master Catalog File (Excel/CSV)</label>
                <input type="file" id="new-supplier-catalog" accept=".xlsx,.xls,.csv">
            </div>

            <div class="form-group">
                <label>Product Images (Multiple)</label>
                <input type="file" id="new-supplier-images" accept="image/*" multiple>
            </div>

            <div class="form-group">
                <label>Pricing Strategy</label>
                <select id="new-supplier-pricing">
                    <option value="markup">Markup from Cost</option>
                    <option value="msrp">Use Supplier MSRP</option>
                    <option value="invoice">Use Invoice Price</option>
                </select>
            </div>

            <div class="form-group" id="markup-input-group">
                <label>Markup Multiplier</label>
                <input type="number" id="new-supplier-markup" placeholder="2.3" step="0.1" value="2.3">
                <small style="color: #666;">e.g., 2.3 means retail = cost √ó 2.3</small>
            </div>

            <div class="btn-row">
                <button class="btn btn-primary" onclick="saveNewSupplier()">üíæ Save Supplier</button>
                <button class="btn btn-secondary" onclick="hideAddSupplierModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Global state
        let suppliers = [];
        let currentInvoiceData = null;
        let processedProducts = [];
        let migrationData = { products: [], customers: [] };
        let migrationFiles = { products: [], customers: [] };

        // Load data on startup
        loadAllData();

        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('process-tab').classList.toggle('hidden', tab !== 'process');
            document.getElementById('suppliers-tab').classList.toggle('hidden', tab !== 'suppliers');
            document.getElementById('migration-tab').classList.toggle('hidden', tab !== 'migration');
            document.getElementById('settings-tab').classList.toggle('hidden', tab !== 'settings');
        }

        async function loadAllData() {
            try {
                const suppliersResult = await window.storage.list('supplier:');
                if (suppliersResult && suppliersResult.keys) {
                    suppliers = await Promise.all(
                        suppliersResult.keys.map(async (key) => {
                            const result = await window.storage.get(key);
                            return result ? JSON.parse(result.value) : null;
                        })
                    );
                    suppliers = suppliers.filter(s => s);
                }
                updateSuppliersList();
                updateSupplierSelect();
            } catch (error) {
                console.log('No saved data found');
            }
        }

        function updateSupplierSelect() {
            const select = document.getElementById('supplier-select');
            const currentValue = select.value;
            select.innerHTML = '<option value="">-- Select Supplier --</option>';
            suppliers.forEach((s, i) => {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = s.name;
                select.appendChild(option);
            });
            if (currentValue) select.value = currentValue;
            document.getElementById('supplier-count').textContent = suppliers.length;
        }

        function updateSuppliersList() {
            const container = document.getElementById('suppliers-list');
            if (suppliers.length === 0) {
                container.innerHTML = '<div class="status info">No suppliers added yet. Click "Add New Supplier" to get started.</div>';
                return;
            }

            container.innerHTML = suppliers.map((s, i) => `
                <div class="supplier-card">
                    <h4>üè≠ ${s.name}</h4>
                    <div class="supplier-info">
                        <div class="supplier-stat">
                            <strong>MASTER FILE</strong>
                            <span>${s.catalogProducts || 0} products</span>
                        </div>
                        <div class="supplier-stat">
                            <strong>IMAGES</strong>
                            <span>${s.images ? s.images.length : 0} photos</span>
                        </div>
                        <div class="supplier-stat">
                            <strong>PRICING</strong>
                            <span>${s.pricingStrategy === 'markup' ? `${s.markup}x markup` : s.pricingStrategy.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-secondary" onclick="editSupplier(${i})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-danger" onclick="deleteSupplier(${i})">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddSupplierModal() {
            document.getElementById('add-supplier-modal').classList.remove('hidden');
            document.getElementById('new-supplier-pricing').addEventListener('change', function() {
                document.getElementById('markup-input-group').style.display = 
                    this.value === 'markup' ? 'block' : 'none';
            });
        }

        function hideAddSupplierModal() {
            document.getElementById('add-supplier-modal').classList.add('hidden');
        }

        async function saveNewSupplier() {
            const name = document.getElementById('new-supplier-name').value.trim();
            const catalogFile = document.getElementById('new-supplier-catalog').files[0];
            const imageFiles = document.getElementById('new-supplier-images').files;
            const pricingStrategy = document.getElementById('new-supplier-pricing').value;
            const markup = parseFloat(document.getElementById('new-supplier-markup').value) || 2.3;

            if (!name) {
                alert('Please enter supplier name');
                return;
            }

            showStatus('Saving supplier...', 'info');

            const supplier = {
                id: Date.now(),
                name: name,
                pricingStrategy: pricingStrategy,
                markup: markup,
                catalog: [],
                images: []
            };

            // Process catalog file
            if (catalogFile) {
                try {
                    const data = catalogFile.name.endsWith('.csv') 
                        ? await readCSV(catalogFile)
                        : await readExcel(catalogFile);
                    
                    const headers = data[0].map(h => String(h || '').trim().toLowerCase());
                    supplier.catalog = data.slice(1).filter(row => row && row.length > 0).map(row => {
                        const item = {};
                        headers.forEach((h, i) => item[h] = row[i]);
                        return item;
                    });
                    supplier.catalogProducts = supplier.catalog.length;
                } catch (error) {
                    console.error('Error processing catalog:', error);
                }
            }

            // Process images
            if (imageFiles.length > 0) {
                for (const file of imageFiles) {
                    if (file.type.startsWith('image/')) {
                        const dataUrl = await readFileAsDataURL(file);
                        supplier.images.push({
                            fileName: file.name,
                            identifier: file.name.split('.')[0].toLowerCase().replace(/[^a-z0-9]/g, ''),
                            dataUrl: dataUrl
                        });
                    }
                }
            }

            // Save to storage
            await window.storage.set(`supplier:${supplier.id}`, JSON.stringify(supplier));
            suppliers.push(supplier);
            
            updateSuppliersList();
            updateSupplierSelect();
            hideAddSupplierModal();
            showStatus(`Supplier "${name}" added successfully!`, 'success');
        }

        async function deleteSupplier(index) {
            if (!confirm(`Delete supplier "${suppliers[index].name}"?`)) return;
            
            await window.storage.delete(`supplier:${suppliers[index].id}`);
            suppliers.splice(index, 1);
            updateSuppliersList();
            updateSupplierSelect();
            showStatus('Supplier deleted', 'success');
        }

        function handleInvoiceUpload(input) {
            if (input.files.length > 0) {
                currentInvoiceData = input.files[0];
                document.getElementById('process-btn').disabled = false;
                showStatus(`Loaded: ${input.files[0].name}`, 'success');
            }
        }

        async function processInvoice() {
            const supplierIndex = document.getElementById('supplier-select').value;
            if (!supplierIndex) {
                showStatus('Please select a supplier', 'error');
                return;
            }
            if (!currentInvoiceData) {
                showStatus('Please upload an invoice', 'error');
                return;
            }

            const supplier = suppliers[supplierIndex];
            showStatus('Processing invoice...', 'info');
            document.getElementById('processing-progress').classList.remove('hidden');
            updateProgress(10, 'Reading invoice...');

            try {
                let invoiceProducts = [];
                
                // Extract data based on file type
                if (currentInvoiceData.name.endsWith('.pdf')) {
                    invoiceProducts = await extractFromPDF(currentInvoiceData);
                } else {
                    const data = currentInvoiceData.name.endsWith('.csv')
                        ? await readCSV(currentInvoiceData)
                        : await readExcel(currentInvoiceData);
                    invoiceProducts = parseInvoiceData(data);
                }

                updateProgress(40, 'Matching products...');

                // Match with supplier catalog and enhance data
                processedProducts = invoiceProducts.map((item, i) => {
                    const catalogMatch = findInCatalog(item, supplier.catalog);
                    const imageMatch = findImage(item, supplier.images);
                    
                    return buildShopifyProduct(item, catalogMatch, imageMatch, supplier, i);
                });

                updateProgress(100, 'Complete!');
                
                document.getElementById('download-btn').disabled = false;
                showPreview();
                showStatus(`‚úÖ Processed ${processedProducts.length} products! ${processedProducts.filter(p => p.matched).length} matched with catalog.`, 'success');
                
                setTimeout(() => {
                    document.getElementById('processing-progress').classList.add('hidden');
                }, 2000);
                
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                console.error(error);
            }
        }

        async function extractFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                fullText += textContent.items.map(item => item.str).join(' ') + '\n';
            }
            
            return parsePDFText(fullText);
        }

        function parsePDFText(text) {
            const products = [];
            const lines = text.split('\n').filter(l => l.trim());
            
            // Simple extraction - looks for patterns with SKU/quantity/price
            const patterns = [
                /([A-Z0-9-]+)\s+(.+?)\s+(\d+)\s+\$?([\d,]+\.?\d*)/gi,
                /(.{10,})\s+(\d+)\s+\$?([\d,]+\.?\d*)/gi
            ];
            
            lines.forEach(line => {
                patterns.forEach(pattern => {
                    const match = pattern.exec(line);
                    if (match) {
                        products.push({
                            rawLine: